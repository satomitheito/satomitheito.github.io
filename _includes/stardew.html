<div class="sprite-section">
    <canvas id="gameCanvas" width="800" height="600"></canvas>
</div>
  
<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const sprite = new Image();
    sprite.src = "/assets/files/cat5.png";

    const map = new Image();
    map.src = "/assets/img/stardewmap.png"; 

    const mapWidth = 2000; 
    const mapHeight = 1600; 
    const frameWidth = 32; 
    const frameHeight = 32; 
    const scale = 2;
    const scaledFrameWidth = frameWidth * scale;
    const scaledFrameHeight = frameHeight * scale;

    const character = {
        x: mapWidth / 2, 
        y: mapHeight / 2,
        speed: 5,
        direction: 0, 
    };

    const camera = {
        x: 0,
        y: 0,
        width: canvas.width,
        height: canvas.height,
        update() {
        this.x = Math.max(0, Math.min(mapWidth - this.width, character.x - this.width / 2));
        this.y = Math.max(0, Math.min(mapHeight - this.height, character.y - this.height / 2));
        },
    };

    const keys = {};
    window.addEventListener("keydown", (e) => (keys[e.key] = true));
    window.addEventListener("keyup", (e) => (keys[e.key] = false));

    window.addEventListener(
        "keydown",
        function (e) {
        if (["Space", "ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight"].indexOf(e.code) > -1) {
            e.preventDefault();
        }
        },
        false
    );

    const directionMapping = {
        ArrowDown: 0, 
        ArrowLeft: 3, 
        ArrowRight: 1, 
        ArrowUp: 2, 
    };

    function update() {
        if (keys["ArrowUp"]) {
        character.y -= character.speed;
        character.direction = directionMapping["ArrowUp"];
        }
        if (keys["ArrowDown"]) {
        character.y += character.speed;
        character.direction = directionMapping["ArrowDown"];
        }
        if (keys["ArrowLeft"]) {
        character.x -= character.speed;
        character.direction = directionMapping["ArrowLeft"];
        }
        if (keys["ArrowRight"]) {
        character.x += character.speed;
        character.direction = directionMapping["ArrowRight"];
        }

        if (character.x < 0) character.x = 0;
        if (character.y < 0) character.y = 0;
        if (character.x > mapWidth - scaledFrameWidth) character.x = mapWidth - scaledFrameWidth;
        if (character.y > mapHeight - scaledFrameHeight) character.y = mapHeight - scaledFrameHeight;

        camera.update();

        frameCounter++;
        if (frameCounter >= frameDelay) {
        frameCounter = 0;
        currentFrame = (currentFrame + 1) % 4;
        }
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        ctx.drawImage(
        map,
        camera.x,
        camera.y,
        camera.width,
        camera.height,
        0,
        0,
        camera.width,
        camera.height
        );

        const sourceX = currentFrame * frameWidth;
        const sourceY = character.direction * frameHeight;
        ctx.drawImage(
        sprite,
        sourceX,
        sourceY,
        frameWidth,
        frameHeight,
        character.x - camera.x,
        character.y - camera.y,
        scaledFrameWidth,
        scaledFrameHeight
        );
    }

    function gameLoop() {
        update();
        draw();
        requestAnimationFrame(gameLoop);
    }

    let imagesLoaded = 0;
    function checkImagesLoaded() {
        imagesLoaded++;
        if (imagesLoaded === 2) gameLoop();
    }
    sprite.onload = checkImagesLoaded;
    map.onload = checkImagesLoaded;
</script>